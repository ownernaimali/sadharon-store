<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - All Orders</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{
  box-sizing:border-box;
  font-family:Arial;
}
body{
  background:#f2f4f8;
  padding:20px;
}
.container{
  max-width:900px;
  margin:auto;
}
h2{
  margin-bottom:15px;
}

/* Admin Order Card */
.order-card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 6px 16px rgba(0,0,0,0.05);
}

.order-header{
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
  margin-bottom: 15px;
}

.customer-name{
  font-weight: bold;
  font-size: 18px;
  display: block;
}

.order-id{
  font-size: 13px;
  color: #777;
}
.address {
  margin-top: 1.5px;
  font-size: 13px;
  color: #777; 
}

/* Item inside order (matches your cart style) */
.item-row{
  display:flex;
  gap:15px;
  align-items:center;
  margin-bottom: 12px;
}
.item-row img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:8px;
}
.item-info{
  flex:1;
}
.item-info h4{
  margin: 0;
  font-size: 15px;
}
.item-info p{
  margin: 2px 0;
  font-size: 13px;
  color: #555;
}

/* Total Section */
.order-footer{
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 15px;
  padding-top: 10px;
  border-top: 1px solid #eee;
}

.total-price{
  font-size: 18px;
  font-weight: bold;
  color: #1e90ff;
}

/* Admin Buttons */
.done-btn{
  background:#1e90ff;
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
.done-btn:hover{
  background:#187bcd;
}
  
  .select-box {
    position: relative;
    width: 160px; /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶õ‡ßã‡¶ü-‡¶¨‡ßú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® */
}

.admin-select {
    /* ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    width: 100%;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
    
    /* ‡¶π‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßã‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
    color: #1e293b;
    background-color: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    
    cursor: pointer;
    outline: none;
    transition: all 0.2s ease;
}

/* ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá */
.admin-select:focus {
    border-color: #14b8a6;
}

/* ‡¶Ü‡¶á‡¶ï‡¶® ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßã ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü (CSS Triangle) */
.select-box::after {
    content: "";
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    
    /* ‡¶™‡¶ø‡¶ì‡¶∞ ‡¶∏‡¶ø‡¶è‡¶∏‡¶è‡¶∏ ‡¶ü‡ßç‡¶∞‡¶æ‡ßü‡¶æ‡¶ô‡ßç‡¶ó‡ßá‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßã */
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #64748b;
    
    pointer-events: none; /* ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßã‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶ì ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá */
}

/* ‡¶Ö‡¶™‡¶∂‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
.admin-select option {
    background-color: #ffffff;
    color: #1e293b;
    padding: 10px;
}

  /* ‡¶¨‡ßá‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
.status-badge {
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 700;
    text-transform: capitalize;
    display: inline-block;
}

/* ‡¶¨‡ßá‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.status-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    display: inline-block;
    text-align: center;
    border: 1px solid transparent;
}

/* Pending - ‡¶ï‡¶Æ‡¶≤‡¶æ */
.status-badge.pending {
    background-color: #fff7ed;
    color: #c2410c;
    border-color: #ffedd5;
}

/* Processing - ‡¶®‡ßÄ‡¶≤ */
.status-badge.processing {
    background-color: #eff6ff;
    color: #1d4ed8;
    border-color: #dbeafe;
}

/* On-the-way - ‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø */
.status-badge.on-the-way {
    background-color: #f5f3ff;
    color: #6d28d9;
    border-color: #ede9fe;
}

/* Delivered - ‡¶∏‡¶¨‡ßÅ‡¶ú */
.status-badge.delivered {
    background-color: #f0fdf4;
    color: #15803d;
    border-color: #dcfce7;
}

/* Cancel / Canceled - ‡¶≤‡¶æ‡¶≤ */
.status-badge.cancel, 
.status-badge.canceled {
    background-color: #fef2f2;
    color: #b91c1c;
    border-color: #fee2e2;
}

  
  
</style>
</head>

<body>

<div class="container">
  <h2>üìã Customer Orders: <span id="length"></span></h2>
  <!--
  <div class="order-card">
    <div class="order-header">
      <div>
        <span class="customer-name">Rahim Ahmed</span>
        <span class="order-id">ID: #44921 | üìû 01700000000</span>
      </div>
      <div style="text-align: right; font-size: 12px; color: #888;">Oct 24, 2023</div>
    </div>

    <div class="item-row">
      <img src="https://via.placeholder.com/60" alt="Product">
      <div class="item-info">
        <h4>Wireless Headphones</h4>
        <p>Price: ‡ß≥1200 | Qty: 1</p>
      </div>
      <strong>‡ß≥1200</strong>
    </div>

    <div class="item-row">
      <img src="https://via.placeholder.com/60" alt="Product">
      <div class="item-info">
        <h4>Fast Charger</h4>
        <p>Price: ‡ß≥800 | Qty: 2</p>
      </div>
      <strong>‡ß≥1600</strong>
    </div>

    <div class="order-footer">
      <div class="total-price">Total: ‡ß≥2800</div>
      <button class="done-btn">Mark as Completed</button>
    </div>
  </div>
-->


  <div id="order">
    <!-- fetch order items -->   
  </div>
  
  
</div>
  <script>
  const LOCALHOST = "http://localhost:3000/orders";
  const SERVER = "https://sadharon-store-server.vercel.app/orders";
  const API = window.location.hostname.includes("vercel") ? SERVER : LOCALHOST;

  async function processingOrder(event, id) {
    const btn = event.currentTarget;
    const statusSelect = document.getElementById(`status-${id}`);
    const newStatus = statusSelect.value;
    
    // UI Feedback: Loading
    const originalText = btn.innerText;
    btn.innerText = "Saving...";
    btn.disabled = true;

    try {
      const response = await fetch(`${API}?id=${id}&status=${newStatus}`, {
        method: 'PATCH'
      });
      const data = await response.json();

      if (data.success) {
        btn.innerText = "Saved!";
        btn.style.background = "#10b981";
        
        // Refresh only the list after a brief pause
        setTimeout(() => {
          btn.innerText = originalText;
          btn.disabled = false;
          btn.style.background = "#0f172a";
          loadProducts();
        }, 1000);
      } else {
        alert("Update failed: " + data.message);
        resetButton(btn, originalText);
      }
    } catch (error) {
      console.error("Error:", error);
      alert("Network Error!");
      resetButton(btn, originalText);
    }
  }

  function resetButton(btn, text) {
    btn.innerText = text;
    btn.disabled = false;
  }

  function loadProducts() {
    fetch(API)
      .then(res => res.json())
      .then(products => {
        const list = document.getElementById("order");
        document.getElementById("length").innerText = products.length;
        
        if (products.length === 0) {
          list.innerHTML = "<p>No orders found.</p>";
          return;
        }

        list.innerHTML = products.reverse().map(p => {
          const total = (p.price * p.quantity) || 0;
          const statusClass = p.status.toLowerCase().replace(/\s+/g, '-');

          return `
            <div class="order-card">
              <div class="order-header">
                <div>
                  <span class="customer-name">${p.customerName}</span>
                  <span class="order-id">ID: #${p._id.slice(-5)} | üìû ${p.customerPhone}</span>
                  <p class="address">${p.customerAddress}</p>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">${p.orderDate}</div>
                  <span class="status-badge ${statusClass}">${p.status}</span>
                </div>
              </div>

              <div class="item-row">
                <img src="../${p.image}" onerror="this.src='https://via.placeholder.com/65'" alt="Product">
                <div class="item-info">
                  <h4>${p.name}</h4>
                  <p>‡ß≥${p.price} √ó ${p.quantity}</p>
                </div>
                <strong>‡ß≥${total}</strong>
              </div>

              <div class="order-footer">
                <div class="total-price">Total: ‡ß≥${total}</div>
                <div style="display: flex; gap: 10px;">
                  <div class="select-box">
                    <select id="status-${p._id}" class="admin-select">
                      <option value="pending" ${p.status === 'pending' ? 'selected' : ''}>Pending</option>
                      <option value="processing" ${p.status === 'processing' ? 'selected' : ''}>Processing</option>
                      <option value="on-the-way" ${p.status === 'on-the-way' ? 'selected' : ''}>On The Way</option>
                      <option value="delivered" ${p.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                      <option value="canceled" ${p.status === 'canceled' ? 'selected' : ''}>Canceled</option>
                    </select>
                  </div>
                  <button onclick='processingOrder(event, "${p._id}")' class="done-btn">Save</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      })
      .catch(err => {
        console.error(err);
        document.getElementById("order").innerHTML = "Failed to load orders.";
      });
  }

  loadProducts();
  
  
  </script>
  
  
</body>
</html>
